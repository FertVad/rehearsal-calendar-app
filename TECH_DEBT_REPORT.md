# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

## –†–µ–∑—é–º–µ
–û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤—É –∫–æ–¥–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Expo/React Native) –∏ –±—ç–∫–µ–Ω–¥–∞ (Express + PostgreSQL/SQLite). –í –¥–æ–∫—É–º–µ–Ω—Ç–µ —Å–æ–±—Ä–∞–Ω—ã —É—è–∑–≤–∏–º–æ—Å—Ç–∏, —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏/–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π.

**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (December 24, 2024):**
- ‚úÖ Token TTL —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 30 –¥–Ω–µ–π (access) –∏ 90 –¥–Ω–µ–π (refresh)
- ‚úÖ Offline user caching —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω - —Ç–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ 401/403
- ‚úÖ Like system migration –∑–∞–≤–µ—Ä—à–µ–Ω–∞ - —É–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ RSVP —Å—Ç–∞—Ç—É—Å—ã
- ‚úÖ Availability type bug –∏—Å–ø—Ä–∞–≤–ª–µ–Ω - custom mode –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 'busy'
- ‚úÖ Batch API endpoint —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è rehearsals

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (–ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏)

### üî¥ Critical
- JWT —Å–µ–∫—Ä–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (hardcoded fallback)
  - –†–∏—Å–∫: –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ø—Ä–æ–¥–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
  - –§–∏–∫—Å: —Ç—Ä–µ–±–æ–≤–∞—Ç—å `JWT_ACCESS_SECRET`/`JWT_REFRESH_SECRET`, –ø–∞–¥–∞—Ç—å –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –±–µ–∑ –Ω–∏—Ö; —Ä–∞–∑–Ω–µ—Å—Ç–∏ —Å–µ–∫—Ä–µ—Ç—ã.
- XSS –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `GET /.well-known/‚Ä¶` (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –∏–Ω–≤–∞–π—Ç–∞)
  - –ù–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `expoHost` –≤ inline-—Å–∫—Ä–∏–ø—Ç–µ (`server/server.js`).
  - –§–∏–∫—Å: —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `JSON.stringify`/`data-*`, —É–±—Ä–∞—Ç—å inline‚ÄëJS –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å CSP nonce/sha256.
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ AsyncStorage (–∫–ª–∏–µ–Ω—Ç)
  - –†–∏—Å–∫: –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.
  - –§–∏–∫—Å: `expo-secure-store` (Keychain/Keystore) –º–∏–Ω–∏–º—É–º –¥–ª—è refresh‚Äë—Ç–æ–∫–µ–Ω–∞, –ª—É—á—à–µ –¥–ª—è –æ–±–æ–∏—Ö.
  - **Note**: ‚úÖ Offline user caching –¥–æ–±–∞–≤–ª–µ–Ω (tokens + cached user data), –Ω–æ secure storage –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- –ù–µ—Ç —Ä–æ—Ç–∞—Ü–∏–∏/–æ—Ç–∑—ã–≤–∞ refresh‚Äë—Ç–æ–∫–µ–Ω–æ–≤
  - –§–∏–∫—Å: —Ö—Ä–∞–Ω–∏—Ç—å refresh‚Äë—Ç–æ–∫–µ–Ω—ã (jti/exp) –≤ –ë–î (—Ö—ç—à), —Ä–æ—Ç–∞—Ü–∏—è –Ω–∞ `/refresh`, –æ—Ç–∑—ã–≤ –ø—Ä–∏ logout/reuse.

### üü† High
- CORS –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ¬´–æ—Ç–∫—Ä—ã—Ç –¥–ª—è –≤—Å–µ—Ö¬ª
  - –§–∏–∫—Å: –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ origin, –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –º–µ—Ç–æ–¥—ã/–∑–∞–≥–æ–ª–æ–≤–∫–∏; dev/prod –∫–æ–Ω—Ñ–∏–≥–∏.
- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ (`PUT /auth/me`)
  - –§–∏–∫—Å: —Ç—Ä–µ–±–æ–≤–∞—Ç—å `currentPassword` –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —á–µ—Ä–µ–∑ `bcrypt.compare`.
- –ù–µ—Ç rate limiting –Ω–∞ auth/–ø—É–±–ª–∏—á–Ω—ã—Ö –ø—É—Ç—è—Ö
  - –§–∏–∫—Å: `express-rate-limit` –¥–ª—è `/api/auth/*`, `*/invite/*`, RSVP –∏ batch.
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ø–∏—Å–∫–∞—Ö
  - –†–µ–ø–µ—Ç–∏—Ü–∏–∏/–æ—Ç–≤–µ—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è ¬´–≤—Å—ë —Å—Ä–∞–∑—É¬ª.
  - –§–∏–∫—Å: keyset‚Äë–ø–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏/ID, –∫—É—Ä—Å–æ—Ä—ã/limit.
- –ù–µ—Ç batch‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Ä–µ–ø–µ—Ç–∏—Ü–∏–∏
  - –§–∏–∫—Å: `GET /api/native/rehearsals/responses/batch`.

### üü° Medium
- ‚úÖ **DONE**: –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –ª–æ–≥–∏ –≤ –∫–ª–∏–µ–Ω—Ç–µ - auth error handling –æ–±–Ω–æ–≤–ª–µ–Ω, —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ dev
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  - –§–∏–∫—Å: `helmet()` + CSP/HSTS/X-Frame-Options/Referrer-Policy.
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–∞—Å—Ç–∏—á–Ω–∞—è
  - –§–∏–∫—Å: `zod/joi/express-validator` –¥–ª—è body/query/params; `express.json({ limit: '100kb' })`.
- –ü—É–ª—ã Postgres –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - –§–∏–∫—Å: `pg.Pool({ max, idleTimeoutMillis, connectionTimeoutMillis })`; pgbouncer –≤ –ø—Ä–æ–¥–µ.
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏
  - –ü—Ä–∏–º–µ—Ä: —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–ø–µ—Ç–∏—Ü–∏–∏ + —Å–ª–æ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ ‚Äî –æ–±–µ—Ä–Ω—É—Ç—å –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å POST
  - –§–∏–∫—Å: –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –∫–ª—é—á–∏/—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è + upsert.
  - **Note**: ‚úÖ Like system —Ç–µ–ø–µ—Ä—å idempotent - UNIQUE(rehearsal_id, user_id)
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –§–∏–∫—Å: Redis –¥–ª—è —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö (—Å–æ—Å—Ç–∞–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–∞ –æ–∫–Ω–æ –¥–∞—Ç), HTTP‚Äë–∫–µ—à (ETag/Last‚ÄëModified).
  - **Note**: ‚úÖ Client-side caching —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ cached user data –≤ AsyncStorage

### üü¢ Low
- `/api/health` –ø—É–±–ª–∏—á–µ–Ω ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å, –Ω–æ –±–µ–∑ –ª–∏—à–Ω–∏—Ö –¥–µ—Ç–∞–ª–µ–π –∏ –ø–æ–¥ rate limit; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –≤ –ø—Ä–æ–¥–µ.
- –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ SQL (`$1` vs `?`) ‚Äî —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤ `db`‚Äë—Å–ª–æ–µ.
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç/–±–∏—Ç—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–π (`server/package.json` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã) ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–Ω–Ω–µ—Ä.

---

## –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (backend)
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è
  - –†–µ–ø–µ—Ç–∏—Ü–∏–∏: `GET /api/native/projects/:projectId/rehearsals?limit=50&before=<iso>` (DESC –ø–æ `starts_at`, keyset‚Äë–∫—É—Ä—Å–æ—Ä—ã).
  - –û—Ç–≤–µ—Ç—ã: `GET /api/native/rehearsals/:id/responses?limit=100&after=<cursor>`; –≤–µ—Ä–Ω—É—Ç—å `nextCursor`.
- –ë–∞—Ç—á‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
  - ‚úÖ **DONE**: `GET /api/native/rehearsals/batch` - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ useRehearsals
  - –î–æ–±–∞–≤–∏—Ç—å: `GET /api/native/rehearsals/responses/batch?rehearsalIds=...` (–∏–ª–∏ POST); –≤–µ—Ä–Ω—É—Ç—å `{ rehearsalId: { responses, stats } }`.
- –ò–Ω–¥–µ–∫—Å—ã
  - `native_rehearsals(project_id, starts_at)`, `(starts_at, ends_at)`.
  - `native_user_availability(user_id, starts_at, ends_at)`, `(source, external_event_id)`.
  - `native_project_members(project_id, user_id, status)`.
  - **Note**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ production PostgreSQL —Å—Ö–µ–º–µ
- –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `pg.Pool` –∏ pgbouncer (transaction pooling).
- –û—á–µ—Ä–µ–¥–∏/–∞—Å–∏–Ω—Ö—Ä–æ–Ω–∫–∞
  - –¢—è–∂–µ–ª—ã–µ –∑–∞–¥–∞—á–∏ (–º–∞—Å—Å–æ–≤—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –∏–º–ø–æ—Ä—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—è) ‚Äî BullMQ/Redis; –±—ã—Å—Ç—Ä—ã–π ACK + `jobId`.
- –õ–∏–º–∏—Ç—ã/—Ç–∞–π–º–∞—É—Ç—ã/–∫–≤–æ—Ç—ã
  - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–µ–ª, –≤—ã—Å—Ç–∞–≤–∏—Ç—å –æ–±—â–∏–π request timeout –Ω–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–µ; rate limit –¥–ª—è —à—É–º–Ω—ã—Ö –ø—É—Ç–µ–π.
- –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å
  - –õ–æ–≥–≥–µ—Ä pino, traceId/requestId; OpenTelemetry –¥–ª—è –º–µ—Ç—Ä–∏–∫/—Ç—Ä–µ–π—Å–æ–≤; –¥–∞—à–±–æ—Ä–¥—ã –ø–æ P95/99.

## –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ UX (frontend)
- –ö–µ—à/–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
  - –°–ª–æ–π –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ React Query (staleTime/cacheTime, `refetchOnWindowFocus=false`).
- –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
  - FlashList/RecyclerListView; React.memo/—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∫–æ–ª–ª–±–µ–∫–∏; –ø–æ–¥–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ (infinite scroll).
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
  - –ë–∞—Ç—á–∏ –ø–æ 10 —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ (p‚Äëlimit) –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å‚Äë–±–∞—Ä–æ–º.
- –û—à–∏–±–∫–∏/—Ä–µ—Ç—Ä–∞–∏
  - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ—Ç—Ä–∞–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã—Ö GET; –æ—Ç–º–µ–Ω–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
  - –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ `expo-secure-store`; –ª–æ–≥–∏ —Ç–æ–ª—å–∫–æ –≤ dev.

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ)
- –ü–æ–ª–∏—Ç–∏–∫–∏ –ø–∞—Ä–æ–ª–µ–π
  - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞/—Å–ª–æ–∂–Ω–æ—Å—Ç—å; –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Ç–µ—á–µ–∫ (–ø—Ä–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏).
- Refresh‚Äë—à—Ç–æ—Ä–º—ã
  - –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è refresh –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ/—Å–µ—Ä–≤–µ—Ä–µ, —Ä–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤; —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ—Ç–∑—ã–≤ refresh –≤ –ë–î.
- HTTPS/Headers
  - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π HTTPS –≤ –ø—Ä–æ–¥–µ; HSTS; —Å—Ç—Ä–æ–≥–∏–π CSP, —É–±—Ä–∞—Ç—å inline‚Äë—Å–∫—Ä–∏–ø—Ç—ã.
- –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –∏ —Ä–µ—Ç–µ–Ω—à–Ω
  - –°—Ä–æ–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π/—Å–ª–æ—Ç–æ–≤; –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ PII –≤ –ª–æ–≥–∞—Ö; —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ ‚Äî –ø–æ–ª–Ω–æ–µ.

---

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è/–¥–æ–ª–≥
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π —ç–Ω–¥–ø–æ–∏–Ω—Ç Telegram‚Äë–ª–æ–≥–∏–Ω–∞
  - –ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `POST /auth/telegram`, –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ä–æ—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º—ã `native_users`
  - –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `first_name/last_name`, —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–µ–∫—É—â–∞—è —Å—Ö–µ–º–∞ –≤ dev/SQLite —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º—ã–º –ø–æ–ª—è–º.
- –°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–π
  - –í `server/package.json` –µ—Å—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ `scripts/migrate-*.js`; –Ω—É–∂–µ–Ω —Ä–∞–±–æ—á–∏–π —Ä–∞–Ω–Ω–µ—Ä –∏ —à–∞–≥ CI ¬´apply migrations¬ª.
- ‚úÖ **DONE**: Like system migration - —É–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ RSVP —Å—Ç–∞—Ç—É—Å—ã (no, maybe)
- ‚úÖ **DONE**: Availability type fix - custom mode –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 'busy' –≤–º–µ—Å—Ç–æ 'tentative'

---

## –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –†–µ–ø–µ—Ç–∏—Ü–∏–∏ –∏ —Å–ª–æ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
  - –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–ø–µ—Ç–∏—Ü–∏–∏ + –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ/–æ—á–∏—Å—Ç–∫–∞ —Å–ª–æ—Ç–æ–≤ ‚Äî –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
- RSVP –∏ –∏–Ω–≤–∞–π—Ç—ã
  - –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: `native_rehearsal_responses (rehearsal_id, user_id)`; `native_project_members (project_id, user_id)`.
  - –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: upsert/ON CONFLICT –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–≤—Ç–æ—Ä–æ–≤.

---

## .env (–ø—Ä–∏–º–µ—Ä)
- `JWT_ACCESS_SECRET=...`
- `JWT_REFRESH_SECRET=...`
- `CORS_ORIGIN=https://example.com`
- `LOG_REQUESTS=false`
- `NODE_ENV=production`
- `DATABASE_URL=postgres://...`

---

## –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (Quick Wins ‚Üí Roadmap)

### –≠—Ç–∞–ø 1 (–±—ã—Å—Ç—Ä—ã–µ —Ñ–∏–∫—Å—ã, —Å–ø—Ä–∏–Ω—Ç 1)
- JWT —Å–µ–∫—Ä–µ—Ç—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã; Helmet + –±–∞–∑–æ–≤—ã–µ security headers; CORS –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫; rate limit –Ω–∞ auth/invite/batch.
- XSS‚Äë–ø–∞—Ç—á –Ω–∞ `/invite` (—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å `expoHost`, —É–±—Ä–∞—Ç—å inline‚ÄëJS/–¥–æ–±–∞–≤–∏—Ç—å CSP nonce).
- –ö–ª–∏–µ–Ω—Ç: –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω—ã –≤ SecureStore; –≤—ã–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤ –ø—Ä–æ–¥–µ.

### –≠—Ç–∞–ø 2 (—Å–ø—Ä–∏–Ω—Ç 1‚Äì2)
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–∞ `GET /rehearsals`, `GET /rehearsals/:id/responses` (keyset/limit/cursor).
- `GET /rehearsals/responses/batch` –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Ö—É–∫–æ–≤.
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è `rehearsals/availability`, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π; —Ä–∞–±–æ—á–∏–π —Ä–∞–Ω–Ω–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–π + —à–∞–≥ –≤ CI.
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `pg.Pool` –∏ pgbouncer; –ª–∏–º–∏—Ç—ã —Ä–∞–∑–º–µ—Ä–∞ —Ç–µ–ª –∏ —Ç–∞–π–º–∞—É—Ç—ã –Ω–∞ –ø—Ä–æ–∫—Å–∏.
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ä–µ–ø–µ—Ç–∏—Ü–∏—è–º–∏ –∏ —Å–ª–æ—Ç–∞–º–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.

### –≠—Ç–∞–ø 3 (—Å–ø—Ä–∏–Ω—Ç 3+)
- –ö–µ—à Redis –¥–ª—è —Å–æ—Å—Ç–∞–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤/–∞–≥—Ä–µ–≥–∞—Ç–æ–≤; –æ—á–µ—Ä–µ–¥–∏ BullMQ –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –∑–∞–¥–∞—á.
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è refresh —Ç–æ–∫–µ–Ω–æ–≤ (—Å–µ—Ä–≤–µ—Ä/–∫–ª–∏–µ–Ω—Ç), —Ä–æ—Ç–∞—Ü–∏—è/—Ä–µ–≤–æ–∫–∞—Ü–∏—è refresh‚Äë—Ç–æ–∫–µ–Ω–æ–≤.
- –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å: pino + OTel; –¥–∞—à–±–æ—Ä–¥—ã –ø–æ P95/99, –∞–ª–µ—Ä—Ç—ã –ø–æ –æ—à–∏–±–∫–∞–º/—Ç–∞–π–º–∞—É—Ç–∞–º.
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π (Telegram‚Äë—Ä–æ—É—Ç, —Å—Ö–µ–º–∞ `native_users`).

---

## –ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Å–Ω–∏–ø–ø–µ—Ç—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π
- Helmet + CORS + Rate limit
```js
import helmet from 'helmet';
import rateLimit from 'express-rate-limit';
import cors from 'cors';
app.use(helmet({ contentSecurityPolicy: false }));
app.use(cors({ origin: process.env.CORS_ORIGIN?.split(',') ?? ['http://localhost:19006'], methods: ['GET','POST','PUT','DELETE'], allowedHeaders: ['Authorization','Content-Type'] }));
app.use(express.json({ limit: '100kb' }));
app.use('/api/auth', rateLimit({ windowMs: 15*60*1000, max: 20 }));
```
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è `expoHost`
```js
const safeHost = expoHost ? JSON.stringify(String(expoHost)) : 'null';
const html = `...<script>const expoHost = ${safeHost}; /* ... */</script>...`;
```
- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–µ–∫—É—â–µ–≥–æ
```js
if (password !== undefined) {
  if (!currentPassword) return res.status(400).json({ error: 'Current password required' });
  const u = await db.get('SELECT password_hash FROM native_users WHERE id = $1', [req.userId]);
  const ok = await bcrypt.compare(currentPassword, u.password_hash);
  if (!ok) return res.status(401).json({ error: 'Invalid current password' });
  const hash = await bcrypt.hash(password, 10);
  updates.push(`password_hash = $${paramIndex++}`);
  values.push(hash);
}
```
- Keyset‚Äë–ø–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
```sql
SELECT * FROM native_rehearsals
WHERE project_id = $1 AND starts_at < $2
ORDER BY starts_at DESC
LIMIT $3;
```

---

–î–æ–∫—É–º–µ–Ω—Ç –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç SECURITY_REPORT.md –∏ SCALABILITY_REPORT.md –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—É–Ω–∫—Ç–∞–º–∏ (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –º–∏–≥—Ä–∞—Ü–∏–∏, –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ö–µ–º—ã, –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏ –ø—Ä.).

